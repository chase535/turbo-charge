name: CRLF To LF

on: 
  push: 
    branches:
      - 'main'

env:
  GITHUB_USER: "${{secrets.USERNAME}}"
  GITHUB_EMAIL: "${{secrets.EMAIL}}"
  GITHUB_TOKEN: "${{secrets.API_TOKEN_GITHUB}}"

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y dos2unix ssh git
      - name: CRLF to LF
        run: |
          git config --global user.name "${GITHUB_USER}"
          git config --global user.email "${GITHUB_EMAIL}"
          mkdir -vp ${{ github.workspace }}/git_clone
          git clone https://"${GITHUB_USER}":"${GITHUB_TOKEN}"@github.com/chase535/turbo-charge.git ${{ github.workspace }}/git_clone -b main --depth=1
          cd ${{ github.workspace }}/git_clone
          files=$(find . -type f -not -path "./.git/*")
          dos2unix ${files}
          [[ -z "$(git diff)" ]] && exit 0
          git add . -f
          git commit -a -m "换行符CRLF转LF"
          git push origin main -f
