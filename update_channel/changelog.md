# v29-v31

因为30、31版本均为修复29版本才有的BUG，所以合并更新日志

### Changelog

1.添加阶梯充电相关选项（安装时音量键选择以及option.txt中自行更改）

2.安装和运行时弱化必要文件检测，缺失非必要但程序完整运行需要的文件时显示相关信息。**安装时提示缺少必要文件的手机请勿尝试强制运行程序，程序内也判断了必要文件是否存在，如不存在将强制停止运行，也就是说，缺少必要文件是肯定无法运行程序的**

3.将相关信息存入/data/adb/turbo-charge/log.txt中，后续log.txt还将包含充电器拔插、配置更改、撞温度墙等信息（画饼要尽可能的大，但牙膏要一点一点的挤）

4.添加一处判定，当数据写入失败时修改文件权限为0644后重新尝试写入数据

5.安装失败时删除modules_update目录下的模块文件夹，已解决即使安装失败，重启手机后也会在Magisk中显示模块的BUG

# v28

### Changelog

1.在模块安装以及程序运行时判断必要文件是否存在，若不存在，则证明不适配此手机，模块安装失败/程序强制停止运行

2.电量大于等于15%时才关闭阶梯充电，以解决健康状态不太好的电池在低电量时充电疯狂断充的问题（酷安@来回拉扯 提供问题产生原因，@这谁顶得住呢 复现，只经过我手机的测试，阈值为15%，所以就设置为15%，但实测将阶梯充电关闭的一小段时间内仍有几率造成1-2次的断充，但总比疯狂断充要好）

3.添加Magisk内部的更新通道，使用Cloudflare做代理，国内劣质网络环境也能正常检测、下载更新，只不过延迟较高

4.重写安装脚本，以适配使用Magisk自带的util_functions.sh脚本进行安装（要求Magisk版本大于20.4）
